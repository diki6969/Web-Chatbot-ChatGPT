import{S as me,i as ve,s as ge,k as S,a as R,q as $,l as I,m as w,h as C,c as A,r as q,J as ne,n as g,b as pe,G as h,u as ie,H as le,y as j,z as J,A as U,K as he,L as oe,M as Ee,g as L,f as ee,d as V,B as X,N as ye,O as Se,v as te,w as Ie}from"../chunks/index.72818363.js";function Ce(n){let s,a,t,e,r,i,p,y,m=n[0]==="user"?"Kamu":"Ikyy",o,O,k,x,E,D;return{c(){s=S("div"),a=S("div"),t=S("div"),e=S("img"),p=R(),y=S("div"),o=$(m),O=R(),k=S("div"),x=$(n[1]),this.h()},l(f){s=I(f,"DIV",{class:!0});var v=w(s);a=I(v,"DIV",{class:!0});var N=w(a);t=I(N,"DIV",{class:!0});var T=w(t);e=I(T,"IMG",{src:!0,alt:!0}),T.forEach(C),N.forEach(C),p=A(v),y=I(v,"DIV",{class:!0});var F=w(y);o=q(F,m),F.forEach(C),O=A(v),k=I(v,"DIV",{class:!0});var P=w(k);x=q(P,n[1]),P.forEach(C),v.forEach(C),this.h()},h(){ne(e.src,r="https://telegra.ph/file/"+(n[0]==="user"?"d50e5008e0f3753717faa.png":"4463acde836734a2dd80e.png"))||g(e,"src",r),g(e,"alt",i=n[0]+" avatar"),g(t,"class","w-10 rounded-full"),g(a,"class","chat-image avatar"),g(y,"class","chat-header"),g(k,"class",E="chat-bubble "+(n[0]==="user"?"chat-bubble-primary":"chat-bubble-secondary")),g(s,"class",D="chat "+(n[0]==="user"?"chat-end":"chat-start")+" justify-end")},m(f,v){pe(f,s,v),h(s,a),h(a,t),h(t,e),h(s,p),h(s,y),h(y,o),h(s,O),h(s,k),h(k,x)},p(f,[v]){v&1&&!ne(e.src,r="https://telegra.ph/file/"+(f[0]==="user"?"d50e5008e0f3753717faa.png":"4463acde836734a2dd80e.png"))&&g(e,"src",r),v&1&&i!==(i=f[0]+" avatar")&&g(e,"alt",i),v&1&&m!==(m=f[0]==="user"?"Kamu":"Ikyy")&&ie(o,m),v&2&&ie(x,f[1]),v&1&&E!==(E="chat-bubble "+(f[0]==="user"?"chat-bubble-primary":"chat-bubble-secondary"))&&g(k,"class",E),v&1&&D!==(D="chat "+(f[0]==="user"?"chat-end":"chat-start")+" justify-end")&&g(s,"class",D)},i:le,o:le,d(f){f&&C(s)}}}function we(n,s,a){let{type:t}=s,{message:e}=s;return n.$$set=r=>{"type"in r&&a(0,t=r.type),"message"in r&&a(1,e=r.message)},[t,e]}class Z extends me{constructor(s){super(),ve(this,s,we,Ce,ge,{type:0,message:1})}}var _e={};(function(n){var s=function(a,t){if(!(this instanceof s))return new s(a,t);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=a,t=t||{},this.headers=t.headers||{},this.payload=t.payload!==void 0?t.payload:"",this.method=t.method||this.payload&&"POST"||"GET",this.withCredentials=!!t.withCredentials,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.addEventListener=function(e,r){this.listeners[e]===void 0&&(this.listeners[e]=[]),this.listeners[e].indexOf(r)===-1&&this.listeners[e].push(r)},this.removeEventListener=function(e,r){if(this.listeners[e]!==void 0){var i=[];this.listeners[e].forEach(function(p){p!==r&&i.push(p)}),i.length===0?delete this.listeners[e]:this.listeners[e]=i}},this.dispatchEvent=function(e){if(!e)return!0;e.source=this;var r="on"+e.type;return this.hasOwnProperty(r)&&(this[r].call(this,e),e.defaultPrevented)?!1:this.listeners[e.type]?this.listeners[e.type].every(function(i){return i(e),!e.defaultPrevented}):!0},this._setReadyState=function(e){var r=new CustomEvent("readystatechange");r.readyState=e,this.readyState=e,this.dispatchEvent(r)},this._onStreamFailure=function(e){var r=new CustomEvent("error");r.data=e.currentTarget.response,this.dispatchEvent(r),this.close()},this._onStreamAbort=function(e){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=function(e){if(this.xhr){if(this.xhr.status!==200){this._onStreamFailure(e);return}this.readyState==this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));var r=this.xhr.responseText.substring(this.progress);this.progress+=r.length,r.split(/(\r\n|\r|\n){2}/g).forEach(function(i){i.trim().length===0?(this.dispatchEvent(this._parseEventChunk(this.chunk.trim())),this.chunk=""):this.chunk+=i}.bind(this))}},this._onStreamLoaded=function(e){this._onStreamProgress(e),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(e){if(!e||e.length===0)return null;var r={id:null,retry:null,data:"",event:"message"};e.split(/\n|\r\n|\r/).forEach(function(p){p=p.trimRight();var y=p.indexOf(this.FIELD_SEPARATOR);if(!(y<=0)){var m=p.substring(0,y);if(m in r){var o=p.substring(y+1).trimLeft();m==="data"?r[m]+=o:r[m]=o}}}.bind(this));var i=new CustomEvent(r.event);return i.data=r.data,i.id=r.id,i},this._checkStreamClosed=function(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url);for(var e in this.headers)this.xhr.setRequestHeader(e,this.headers[e]);this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))}};n.SSE=s})(_e);function ue(n,s,a){const t=n.slice();return t[11]=s[a],t}function ce(n){let s,a;return s=new Z({props:{type:n[11].role,message:n[11].content}}),{c(){j(s.$$.fragment)},l(t){J(s.$$.fragment,t)},m(t,e){U(s,t,e),a=!0},p(t,e){const r={};e&8&&(r.type=t[11].role),e&8&&(r.message=t[11].content),s.$set(r)},i(t){a||(L(s.$$.fragment,t),a=!0)},o(t){V(s.$$.fragment,t),a=!1},d(t){X(s,t)}}}function fe(n){let s,a;return s=new Z({props:{type:"assistant",message:n[1]}}),{c(){j(s.$$.fragment)},l(t){J(s.$$.fragment,t)},m(t,e){U(s,t,e),a=!0},p(t,e){const r={};e&2&&(r.message=t[1]),s.$set(r)},i(t){a||(L(s.$$.fragment,t),a=!0)},o(t){V(s.$$.fragment,t),a=!1},d(t){X(s,t)}}}function de(n){let s,a;return s=new Z({props:{type:"assistant",message:"Loading.."}}),{c(){j(s.$$.fragment)},l(t){J(s.$$.fragment,t)},m(t,e){U(s,t,e),a=!0},i(t){a||(L(s.$$.fragment,t),a=!0)},o(t){V(s.$$.fragment,t),a=!1},d(t){X(s,t)}}}function Oe(n){let s,a,t,e,r,i,p,y,m,o,O,k,x,E,D,f,v,N,T,F,P,z,K,Q,se;O=new Z({props:{type:"assistant",message:"Halo saya ikyy, apakah ada yang bisa saya bantu?"}});let B=n[3],c=[];for(let l=0;l<B.length;l+=1)c[l]=ce(ue(n,B,l));const be=l=>V(c[l],1,1,()=>{c[l]=null});let _=n[1]&&fe(n),b=n[2]&&de();return{c(){s=S("div"),a=S("div"),t=S("h1"),e=$("IKYY CHAT BOT"),r=R(),i=S("p"),p=$("Powered By IkyyOFC"),y=R(),m=S("div"),o=S("div"),j(O.$$.fragment),k=R();for(let l=0;l<c.length;l+=1)c[l].c();x=R(),_&&_.c(),E=R(),b&&b.c(),D=R(),f=S("div"),v=R(),N=S("form"),T=S("input"),F=R(),P=S("button"),z=$("Kirim"),this.h()},l(l){s=I(l,"DIV",{class:!0});var d=w(s);a=I(d,"DIV",{});var u=w(a);t=I(u,"H1",{class:!0});var G=w(t);e=q(G,"IKYY CHAT BOT"),G.forEach(C),r=A(u),i=I(u,"P",{class:!0});var ae=w(i);p=q(ae,"Powered By IkyyOFC"),ae.forEach(C),u.forEach(C),y=A(d),m=I(d,"DIV",{class:!0});var M=w(m);o=I(M,"DIV",{class:!0});var H=w(o);J(O.$$.fragment,H),k=A(H);for(let W=0;W<c.length;W+=1)c[W].l(H);x=A(H),_&&_.l(H),E=A(H),b&&b.l(H),H.forEach(C),D=A(M),f=I(M,"DIV",{class:!0}),w(f).forEach(C),M.forEach(C),v=A(d),N=I(d,"FORM",{class:!0});var Y=w(N);T=I(Y,"INPUT",{type:!0,class:!0}),F=A(Y),P=I(Y,"BUTTON",{type:!0,class:!0});var re=w(P);z=q(re,"Kirim"),re.forEach(C),Y.forEach(C),d.forEach(C),this.h()},h(){g(t,"class","text-2xl font-bold w-full text-center"),g(i,"class","text-sm italic"),g(o,"class","flex flex-col gap-2"),g(f,"class",""),g(m,"class","h-[500px] w-full bg-gray-900 rounded-md p-4 overflow-y-auto flex flex-col gap-4"),g(T,"type","text"),g(T,"class","input input-bordered w-full"),g(P,"type","submit"),g(P,"class","btn btn-accent"),g(N,"class","flex w-full rounded-md gap-4 bg-gray-900 p-4"),g(s,"class","flex flex-col pt-4 w-full px-8 items-center gap-2")},m(l,d){pe(l,s,d),h(s,a),h(a,t),h(t,e),h(a,r),h(a,i),h(i,p),h(s,y),h(s,m),h(m,o),U(O,o,null),h(o,k);for(let u=0;u<c.length;u+=1)c[u]&&c[u].m(o,null);h(o,x),_&&_.m(o,null),h(o,E),b&&b.m(o,null),h(m,D),h(m,f),n[6](f),h(s,v),h(s,N),h(N,T),he(T,n[0]),h(N,F),h(N,P),h(P,z),K=!0,Q||(se=[oe(T,"input",n[7]),oe(N,"submit",Ee(n[8]))],Q=!0)},p(l,[d]){if(d&8){B=l[3];let u;for(u=0;u<B.length;u+=1){const G=ue(l,B,u);c[u]?(c[u].p(G,d),L(c[u],1)):(c[u]=ce(G),c[u].c(),L(c[u],1),c[u].m(o,x))}for(te(),u=B.length;u<c.length;u+=1)be(u);ee()}l[1]?_?(_.p(l,d),d&2&&L(_,1)):(_=fe(l),_.c(),L(_,1),_.m(o,E)):_&&(te(),V(_,1,1,()=>{_=null}),ee()),l[2]?b?d&4&&L(b,1):(b=de(),b.c(),L(b,1),b.m(o,null)):b&&(te(),V(b,1,1,()=>{b=null}),ee()),d&1&&T.value!==l[0]&&he(T,l[0])},i(l){if(!K){L(O.$$.fragment,l);for(let d=0;d<B.length;d+=1)L(c[d]);L(_),L(b),K=!0}},o(l){V(O.$$.fragment,l),c=c.filter(Boolean);for(let d=0;d<c.length;d+=1)V(c[d]);V(_),V(b),K=!1},d(l){l&&C(s),X(O),ye(c,l),_&&_.d(),b&&b.d(),n[6](null),Q=!1,Se(se)}}}function ke(n,s,a){let t="",e="",r=!1,i=[],p;function y(){setTimeout(function(){p.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},100)}const m=async()=>{a(2,r=!0),a(3,i=[...i,{role:"user",content:t}]);const E=new _e.SSE("/api/chat",{headers:{"Content-Type":"application/json"},payload:JSON.stringify({messages:i})});a(0,t=""),E.addEventListener("error",o),E.addEventListener("message",D=>{y();try{if(a(2,r=!1),D.data==="[DONE]"){a(3,i=[...i,{role:"assistant",content:e}]),a(1,e="");return}const f=JSON.parse(D.data),[{delta:v}]=f.choices;v.content&&a(1,e=(e??"")+v.content)}catch(f){o(f)}}),E.stream(),y()};function o(E){a(2,r=!1),a(0,t=""),a(1,e=""),console.error(E)}function O(E){Ie[E?"unshift":"push"](()=>{p=E,a(4,p)})}function k(){t=this.value,a(0,t)}return[t,e,r,i,p,m,O,k,()=>m()]}class Ne extends me{constructor(s){super(),ve(this,s,ke,Oe,ge,{})}}export{Ne as default};
